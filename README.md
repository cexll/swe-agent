# Pilot SWE - Software Engineering Agent

GitHub App webhook æœåŠ¡ï¼Œé€šè¿‡ `/pilot` å‘½ä»¤è§¦å‘ AI è‡ªåŠ¨å®Œæˆä»£ç ä¿®æ”¹ä»»åŠ¡ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ¤– **AI é©±åŠ¨** - åŸºäº Claude Code CLIï¼Œå¯æ‰©å±•å¤š AI provider
- ğŸ” **å®‰å…¨éªŒè¯** - GitHub webhook ç­¾åéªŒè¯ï¼ˆHMAC SHA-256ï¼‰
- âš¡ **å¼‚æ­¥å¤„ç†** - ç«‹å³å“åº” webhookï¼Œåå°æ‰§è¡Œä»»åŠ¡
- ğŸ“¦ **è‡ªåŠ¨åŒ–æµç¨‹** - Clone â†’ AI ä¿®æ”¹ â†’ Commit â†’ Push â†’ åˆ›å»º PR é“¾æ¥
- ğŸ¯ **å¯é…ç½®è§¦å‘è¯** - é»˜è®¤ `/pilot`ï¼Œå¯è‡ªå®šä¹‰
- ğŸ¨ **Clean Architecture** - Provider æ¥å£æŠ½è±¡ï¼Œæ˜“äºæ‰©å±•

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

- **ä»£ç é‡ï¼š** 12 ä¸ª Go æ–‡ä»¶ï¼Œ~800 è¡Œä»£ç 
- **ç¼–è¯‘äº§ç‰©ï¼š** 8.3MB å•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶
- **ä¾èµ–ï¼š** Minimal - Go 1.21+, Claude Code CLI, GitHub CLI
- **æ€§èƒ½ï¼š** å¯åŠ¨æ—¶é—´ ~100msï¼Œå†…å­˜å ç”¨ ~50MB

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå˜é‡

```bash
# GitHub App é…ç½®
GITHUB_APP_ID=123456
GITHUB_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n..."
GITHUB_WEBHOOK_SECRET=your-webhook-secret

# Claude API
ANTHROPIC_API_KEY=sk-ant-xxx
CLAUDE_MODEL=claude-3-5-sonnet-20241022

# å¯é€‰é…ç½®
TRIGGER_KEYWORD=/pilot
PORT=3000
```

### æœ¬åœ°è¿è¡Œ

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repo-url>
cd swe

# 2. å®‰è£…ä¾èµ–
go mod download

# 3. è®¾ç½®ç¯å¢ƒå˜é‡
export ANTHROPIC_API_KEY=sk-ant-xxx
export GITHUB_APP_ID=123456
# ... å…¶ä»–ç¯å¢ƒå˜é‡

# 4. è¿è¡Œ
go run cmd/main.go
```

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t pilot-swe .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 3000:3000 \
  -e GITHUB_APP_ID=123456 \
  -e GITHUB_PRIVATE_KEY="$(cat private-key.pem)" \
  -e GITHUB_WEBHOOK_SECRET=secret \
  -e ANTHROPIC_API_KEY=sk-ant-xxx \
  --name pilot-swe \
  pilot-swe
```

## ä½¿ç”¨æ–¹æ³•

### 1. é…ç½® GitHub App

1. åˆ›å»º GitHub Appï¼šhttps://github.com/settings/apps/new
2. æƒé™è®¾ç½®ï¼š
   - Repository permissions:
     - Contents: Read & Write
     - Issues: Read & Write
     - Pull requests: Read & Write
   - Subscribe to events:
     - Issue comments
3. Webhook è®¾ç½®ï¼š
   - URL: `https://your-domain.com/webhook`
   - Secret: ç”Ÿæˆä¸€ä¸ªéšæœºå¯†é’¥
4. å®‰è£…åˆ°ä»“åº“

### 2. åœ¨ Issue/PR è¯„è®ºä¸­è§¦å‘

```markdown
/pilot fix the typo in README.md

/pilot add error handling to the main function

/pilot refactor the database connection code
```

### 3. Pilot è‡ªåŠ¨æ‰§è¡Œ

1. âœ… Clone ä»“åº“
2. âœ… è°ƒç”¨ Claude API ç”Ÿæˆä¿®æ”¹
3. âœ… åº”ç”¨ä¿®æ”¹å¹¶ commit
4. âœ… Push åˆ°æ–°åˆ†æ”¯
5. âœ… å›å¤è¯„è®ºï¼ŒåŒ…å« PR åˆ›å»ºé“¾æ¥

### 4. æŸ¥çœ‹ç»“æœ

Pilot ä¼šåœ¨åŸè¯„è®ºä¸‹å›å¤ï¼š

```markdown
### âœ… Task Completed Successfully

**Summary:** Fixed typo in README.md

**Modified Files:** (1)

- `README.md`

**Next Step:**
[ğŸš€ Click here to create Pull Request](https://github.com/owner/repo/compare/main...pilot/123-1234567890?expand=1)

---

_Generated by Pilot SWE_
```

## API ç«¯ç‚¹

### POST /webhook

æ¥æ”¶ GitHub webhook äº‹ä»¶

**Headers:**

- `X-Hub-Signature-256`: GitHub webhook ç­¾å
- `Content-Type`: application/json

**Body:** GitHub issue_comment event payload

### GET /health

å¥åº·æ£€æŸ¥ç«¯ç‚¹

**Response:** `200 OK`

### GET /

æœåŠ¡ä¿¡æ¯

**Response:**

```json
{
  "service": "pilot-swe",
  "status": "running",
  "trigger": "/pilot"
}
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç›®å½•ç»“æ„

```
swe/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go                    # HTTP æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go              # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ webhook/
â”‚   â”‚   â”œâ”€â”€ handler.go             # Webhook äº‹ä»¶å¤„ç†
â”‚   â”‚   â”œâ”€â”€ verify.go              # HMAC ç­¾åéªŒè¯
â”‚   â”‚   â””â”€â”€ types.go               # Webhook payload ç±»å‹
â”‚   â”œâ”€â”€ provider/
â”‚   â”‚   â”œâ”€â”€ provider.go            # Provider æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ factory.go             # Provider å·¥å‚
â”‚   â”‚   â””â”€â”€ claude/
â”‚   â”‚       â””â”€â”€ claude.go          # Claude Provider å®ç°
â”‚   â”œâ”€â”€ github/
â”‚   â”‚   â”œâ”€â”€ clone.go               # gh repo clone
â”‚   â”‚   â”œâ”€â”€ comment.go             # gh issue comment
â”‚   â”‚   â””â”€â”€ pr.go                  # gh pr create
â”‚   â””â”€â”€ executor/
â”‚       â””â”€â”€ task.go                # ä»»åŠ¡æ‰§è¡Œå™¨ï¼ˆæ ¸å¿ƒæµç¨‹ï¼‰
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ go.mod
â””â”€â”€ README.md
```

### æ¶æ„äº®ç‚¹ï¼ˆLinus é£æ ¼ï¼‰

#### 1. **Provider æŠ½è±¡** - æ¶ˆé™¤ç‰¹æ®Šåˆ†æ”¯

```go
// å¥½å“å‘³çš„è®¾è®¡ï¼šæ—  if provider == "claude" åˆ†æ”¯
type Provider interface {
    GenerateCode(ctx context.Context, req *CodeRequest) (*CodeResponse, error)
    Name() string
}

// å·¥å‚æ¨¡å¼ç»Ÿä¸€åˆ›å»º
provider.NewProvider(&Config{
    Name:         "claude",  // æœªæ¥å¯æ”¹ä¸º "codex", "gemini"
    ClaudeAPIKey: "...",
})

// æ–°å¢ provider åªéœ€ï¼š
// 1. å®ç° Provider æ¥å£
// 2. åœ¨ factory.go æ·»åŠ  case
// é›¶ä¿®æ”¹ç°æœ‰ä»£ç ï¼
```

#### 2. **æ¸…æ™°çš„æ•°æ®æµ**

```
GitHub Webhook
      â†“
  Handler (éªŒè¯ç­¾å)
      â†“
  Executor (ç¼–æ’)
      â†“
  Provider (AI ç”Ÿæˆ)
      â†“
  GitHub Ops (æ“ä½œ)
      â†“
  Comment (åé¦ˆ)
```

#### 3. **é”™è¯¯å¤„ç†ç­–ç•¥**

```go
// å¤±è´¥æ—¶è‡ªåŠ¨å›å¤é”™è¯¯è¯„è®ºåˆ° GitHub
if err != nil {
    return e.notifyError(task, errorMsg)
    // ç”¨æˆ·åœ¨ GitHub çœ‹åˆ°è¯¦ç»†é”™è¯¯ï¼Œæ— éœ€æŸ¥æ—¥å¿—
}
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶            | èŒè´£                                         | æ–‡ä»¶æ•° |
| --------------- | -------------------------------------------- | ------ |
| Webhook Handler | æ¥æ”¶ã€éªŒè¯ã€è§£æ GitHub äº‹ä»¶                 | 3      |
| Provider        | AI ä»£ç ç”ŸæˆæŠ½è±¡å±‚                            | 3      |
| Executor        | ä»»åŠ¡ç¼–æ’ï¼ˆClone â†’ Generate â†’ Commit â†’ Pushï¼‰ | 1      |
| GitHub Ops      | Git æ“ä½œå°è£…ï¼ˆåŸºäº gh CLIï¼‰                  | 3      |
| Config          | ç¯å¢ƒå˜é‡ç®¡ç†å’ŒéªŒè¯                           | 1      |

## ğŸ“¦ ä¾èµ–

- **Go 1.21+** - ç¼–è¯‘è¿è¡Œç¯å¢ƒ
- **Claude Code CLI** - AI ä»£ç ç”Ÿæˆï¼ˆé€šè¿‡ lancekrogers/claude-code-goï¼‰
- **GitHub CLI (`gh`)** - Git æ“ä½œ
- **Gorilla Mux** - HTTP è·¯ç”±

## âš¡ å½“å‰èƒ½åŠ›

### âœ… v0.1 MVP å·²å®ç°

- âœ… å“åº” `issue_comment` äº‹ä»¶ä¸­çš„ `/pilot` å‘½ä»¤
- âœ… HMAC SHA-256 webhook ç­¾åéªŒè¯ï¼ˆé˜²ä¼ªé€ ï¼‰
- âœ… è°ƒç”¨ Claude Code CLI ç”Ÿæˆä»£ç ä¿®æ”¹
- âœ… è‡ªåŠ¨ cloneã€ä¿®æ”¹ã€commitã€push åˆ°æ–°åˆ†æ”¯
- âœ… åˆ›å»º PR é“¾æ¥å¹¶å›å¤åˆ°åŸè¯„è®º
- âœ… Provider æ¥å£æŠ½è±¡ï¼ˆæ˜“äºæ‰©å±•åˆ°å…¶ä»– AIï¼‰
- âœ… Docker éƒ¨ç½²æ”¯æŒ
- âœ… é”™è¯¯è‡ªåŠ¨é€šçŸ¥åˆ° GitHub è¯„è®º

### âŒ å½“å‰é™åˆ¶

- âŒ ä¸æ”¯æŒ PR review comments è§¦å‘
- âŒ ä¸æ”¯æŒå¹¶å‘æ§åˆ¶ï¼ˆåŒä¸€ PR åŒæ—¶å¤šä¸ªå‘½ä»¤ä¼šå†²çªï¼‰
- âŒ ä¸æ”¯æŒè¿›åº¦è¿½è¸ªï¼ˆæ— æ³•å®æ—¶æ›´æ–°è¯„è®ºï¼‰
- âŒ ä¸æ”¯æŒä»»åŠ¡é˜Ÿåˆ—ï¼ˆwebhook è¶…æ—¶åæ— é‡è¯•ï¼‰
- âŒ ä»…æ”¯æŒ Claude providerï¼ˆCodex/Gemini å¾…å®ç°ï¼‰

## ğŸ—ºï¸ è·¯çº¿å›¾

### v0.2 - ç”Ÿäº§å°±ç»ª

- [ ] **PR review comments æ”¯æŒ** - åœ¨ä»£ç è¡Œæ·»åŠ è¯„è®ºè§¦å‘
- [ ] **ä»»åŠ¡é˜Ÿåˆ—** - Redis æˆ–å†…å­˜é˜Ÿåˆ—ï¼Œæ”¯æŒé‡è¯•
- [ ] **å¹¶å‘æ§åˆ¶** - æ¯ä¸ª PR/Issue åŒæ—¶åªèƒ½ä¸€ä¸ªä»»åŠ¡
- [ ] **é€Ÿç‡é™åˆ¶** - é˜²æ­¢æ»¥ç”¨ï¼ˆæ¯ä»“åº“/å°æ—¶é™åˆ¶ï¼‰
- [ ] **è¿›åº¦è¿½è¸ª** - å®æ—¶æ›´æ–°è¯„è®ºæ˜¾ç¤ºæ‰§è¡Œè¿›åº¦
- [ ] **æ—¥å¿—æ”¹è¿›** - ç»“æ„åŒ–æ—¥å¿—ï¼ˆJSONï¼‰+ æ—¥å¿—çº§åˆ«

### v0.3 - åŠŸèƒ½æ‰©å±•

- [ ] **å¤š AI Provider**
  - [ ] OpenAI Codex provider
  - [ ] Google Gemini provider
  - [ ] AMP provider
  - [ ] å¯é…ç½® provider é€‰æ‹©
- [ ] **Web UI** - ä»»åŠ¡ç›‘æ§ã€é…ç½®ç®¡ç†ç•Œé¢
- [ ] **æŒ‡æ ‡å’Œç›‘æ§** - Prometheus metrics + Grafana
- [ ] **ä¸€é”®éƒ¨ç½²** - Railway/Render/Vercel éƒ¨ç½²æŒ‰é’®

### v0.4 - ä¼ä¸šç‰¹æ€§

- [ ] **å›¢é˜Ÿæƒé™ç®¡ç†** - é™åˆ¶è°å¯ä»¥è§¦å‘
- [ ] **æˆæœ¬æ§åˆ¶** - API è´¹ç”¨é¢„ç®—å’Œå‘Šè­¦
- [ ] **å®¡è®¡æ—¥å¿—** - æ‰€æœ‰æ“ä½œè®°å½•
- [ ] **Webhook é‡æ”¾** - æ‰‹åŠ¨é‡è¯•å¤±è´¥çš„ä»»åŠ¡
- [ ] **å¤šä»“åº“ç®¡ç†** - ç»Ÿä¸€é…ç½®å¤šä¸ªä»“åº“

## å®‰å…¨æ³¨æ„äº‹é¡¹

1. âœ… **Webhook ç­¾åéªŒè¯** - ä½¿ç”¨ HMAC SHA-256
2. âœ… **å¸¸é‡æ—¶é—´æ¯”è¾ƒ** - é˜²æ­¢æ—¶åºæ”»å‡»
3. âš ï¸ **API å¯†é’¥ç®¡ç†** - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
4. âš ï¸ **é€Ÿç‡é™åˆ¶** - å»ºè®®æ·»åŠ ï¼ˆv0.2ï¼‰
5. âš ï¸ **å¹¶å‘æ§åˆ¶** - å»ºè®®æ·»åŠ ï¼ˆv0.2ï¼‰

## é™åˆ¶ï¼ˆv0.1 MVPï¼‰

- âŒ ä¸æ”¯æŒ PR review comments
- âŒ ä¸æ”¯æŒå¹¶å‘æ‰§è¡Œï¼ˆåŒä¸€ PR å¤šä¸ªå‘½ä»¤ï¼‰
- âŒ ä¸æ”¯æŒè¿›åº¦è¿½è¸ªï¼ˆå®æ—¶æ›´æ–°è¯„è®ºï¼‰
- âŒ ä¸æ”¯æŒä»»åŠ¡é˜Ÿåˆ—
- âŒ ä¸æ”¯æŒé™¤ Claude å¤–çš„å…¶ä»– AI provider

## è·¯çº¿å›¾

### v0.2

- [ ] PR review comments æ”¯æŒ
- [ ] é˜Ÿåˆ—ç³»ç»Ÿå’Œå¹¶å‘æ§åˆ¶
- [ ] é€Ÿç‡é™åˆ¶
- [ ] è¿›åº¦è¿½è¸ªï¼ˆå®æ—¶æ›´æ–°è¯„è®ºï¼‰

### v0.3

- [ ] æ”¯æŒå¤š AI providerï¼ˆCodex, Gemini, AMPï¼‰
- [ ] Web UI ç®¡ç†ç•Œé¢
- [ ] æŒ‡æ ‡å’Œç›‘æ§
- [ ] ä¸€é”®éƒ¨ç½²ï¼ˆRailway/Vercelï¼‰

## æ•…éšœæ’æŸ¥

### 1. Webhook æœªè§¦å‘

æ£€æŸ¥ï¼š

- GitHub App æ˜¯å¦æ­£ç¡®å®‰è£…
- Webhook URL æ˜¯å¦å¯è®¿é—®
- Webhook secret æ˜¯å¦åŒ¹é…

### 2. Claude API é”™è¯¯

æ£€æŸ¥ï¼š

- `ANTHROPIC_API_KEY` æ˜¯å¦æ­£ç¡®
- API é…é¢æ˜¯å¦ç”¨å®Œ
- ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### 3. Git æ“ä½œå¤±è´¥

æ£€æŸ¥ï¼š

- `gh` CLI æ˜¯å¦å®‰è£…å¹¶è®¤è¯
- GitHub App æ˜¯å¦æœ‰ Contents å†™æƒé™
- åˆ†æ”¯åæ˜¯å¦å†²çª

## ğŸ¯ è®¾è®¡å“²å­¦ï¼ˆLinus é£æ ¼ï¼‰

### 1. ç®€å•èƒœäºå¤æ‚

- **å•ä¸€èŒè´£ï¼š** æ¯ä¸ªåŒ…åªåšä¸€ä»¶äº‹
- **æ¸…æ™°å‘½åï¼š** `provider.Provider` è€Œé `AIService`
- **æµ…å±‚ç¼©è¿›ï¼š** å‡½æ•°ä¸è¶…è¿‡ 3 å±‚ç¼©è¿›

### 2. å¥½å“å‘³çš„ä»£ç 

```go
// âŒ åå“å‘³ï¼šç‰¹æ®Šåˆ†æ”¯åœ°ç‹±
if provider == "claude" {
    callClaude()
} else if provider == "codex" {
    callCodex()
} else if provider == "gemini" {
    callGemini()
}

// âœ… å¥½å“å‘³ï¼šæ¥å£æŠ½è±¡
provider.GenerateCode(req)  // å¤šæ€ï¼Œé›¶åˆ†æ”¯
```

### 3. å‘åå…¼å®¹

- Provider æ¥å£è®¾è®¡æ”¯æŒæœªæ¥æ‰©å±•
- é…ç½®å‘å‰å…¼å®¹ï¼ˆæ–°å¢å­—æ®µæœ‰é»˜è®¤å€¼ï¼‰
- API ä¸åšç ´åæ€§å˜æ›´

### 4. å®ç”¨ä¸»ä¹‰

- ç›´æ¥è°ƒç”¨ CLI è€Œéé‡æ–°å®ç°ï¼ˆç«™åœ¨å·¨äººè‚©ä¸Šï¼‰
- ä½¿ç”¨ `gh` CLI è€Œéå¤æ‚çš„ GitHub API åº“
- é”™è¯¯ç›´æ¥åé¦ˆåˆ° GitHubï¼Œè€Œéè—åœ¨æ—¥å¿—é‡Œ

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ PRï¼

### æ·»åŠ æ–°çš„ AI Provider

1. åœ¨ `internal/provider/<name>/` åˆ›å»ºç›®å½•
2. å®ç° `Provider` æ¥å£ï¼š
   ```go
   type Provider interface {
       GenerateCode(ctx, req) (*CodeResponse, error)
       Name() string
   }
   ```
3. åœ¨ `factory.go` æ·»åŠ  case
4. æ›´æ–°æ–‡æ¡£

### ä»£ç é£æ ¼

- ä½¿ç”¨ `go fmt` æ ¼å¼åŒ–
- éµå¾ª Linus çš„"å¥½å“å‘³"åŸåˆ™
- å‡½æ•°ä¸è¶…è¿‡ 50 è¡Œ
- é¿å…æ·±å±‚åµŒå¥—

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [Claude Code](https://github.com/anthropics/claude-code) - AI ä»£ç åŠ©æ‰‹
- [lancekrogers/claude-code-go](https://github.com/lancekrogers/claude-code-go) - Go SDK
- [GitHub CLI](https://cli.github.com/) - Git æ“ä½œå·¥å…·
- Linus Torvalds - "Good taste" ç¼–ç¨‹å“²å­¦
